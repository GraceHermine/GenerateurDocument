<div class="templates-page">
  <section class="hero">
    <div class="hero-content">
      <p class="eyebrow">Bibliothèque publique</p>
      <h1>Templates prêts à l'emploi</h1>
      <p class="subtitle">
        Parcourez une sélection de modèles conçus pour accélérer la création de vos documents.
      </p>
      <div class="hero-stats">
        <div class="stat">
          <span class="stat-value">{{ allTemplates.length }}</span>
          <span class="stat-label">Modèles disponibles</span>
        </div>
        <div class="stat">
          <span class="stat-value">{{ categories.length }}</span>
          <span class="stat-label">Catégories actives</span>
        </div>
        <div class="stat">
          <span class="stat-value">{{ displayedTemplates.length }}</span>
          <span class="stat-label">Affichés</span>
        </div>
      </div>
    </div>
    <div class="hero-panel">
      <div class="panel-title">Astuce de productivite</div>
      <p class="panel-text">
        Commencez par un template court, puis enrichissez-le selon vos besoins. Vous gagnez du temps
        et gardez une structure claire.
      </p>
      <div class="panel-badge">Nouveaux modèles chaque semaine</div>
    </div>
  </section>

  <section class="filters">
    <div class="filter-row" role="tablist" aria-label="Filtres de categorie">
      <button
        (click)="filterByCategory(null)"
        [class]="selectedCategoryId === null ? 'chip chip-active' : 'chip'"
      >
        Tous <span class="chip-count">{{ allTemplates.length }}</span>
      </button>

      <button
        *ngFor="let cat of categories"
        (click)="filterByCategory(cat.id)"
        [class]="selectedCategoryId === cat.id ? 'chip chip-active' : 'chip'"
      >
        {{ cat.nom }} <span class="chip-count">{{ getTemplatesByCategory(cat.id).length }}</span>
      </button>
    </div>
  </section>

  <section
    *ngIf="!isLoading && displayedTemplates.length > 0"
    class="templates-grid"
  >
    <article *ngFor="let template of displayedTemplates" class="template-card">
      <div class="card-top">
        <span class="category-pill">{{ template.categorie_nom }}</span>
        <span class="card-id">#{{ template.id }}</span>
      </div>

      <h3>{{ template.nom }}</h3>

      <p class="card-desc">
        {{ template.description || 'Prêt à l\'emploi pour vos documents.' }}
      </p>

      <div class="card-meta">
        <span>Format intelligent</span>
        <span>Compatibilite multi-usages</span>
      </div>

      <div class="card-actions">
        <button
          [routerLink]="['/user/template-preview', template.id]"
          class="btn-outline"
        >
          Apercu
        </button>
        <button
          [routerLink]="['/public/dynamic-form', template.id]"
          class="btn-solid"
        >
          Utiliser
        </button>
      </div>
    </article>
  </section>

  <section *ngIf="isLoading" class="state-panel">
    <div class="loader"></div>
    <p>Chargement de la bibliotheque...</p>
  </section>

  <section *ngIf="!isLoading && displayedTemplates.length === 0" class="state-panel empty">
    <h3>Aucun template ne correspond a cette categorie.</h3>
    <p>Essayez un autre filtre pour decouvrir nos modeles disponibles.</p>
    <button (click)="filterByCategory(null)" class="btn-solid">
      Voir tous les modeles
    </button>
  </section>
</div>