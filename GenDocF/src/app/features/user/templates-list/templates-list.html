<div class="p-8">
  <div class="mb-8">
    <h2 class="text-3xl font-bold">
      Bibliothèque de Templates ({{ displayedTemplates.length }})
    </h2>
  </div>

  <div class="flex gap-3 mb-8 overflow-x-auto pb-2">
    <button (click)="filterByCategory(null)"
      [class]="selectedCategoryId === null ? 'bg-primary text-white' : 'bg-[#f3ece7]'"
      class="rounded-full px-5 py-2 transition-colors whitespace-nowrap">
      Tous ({{ allTemplates.length }})
    </button>

    <button *ngFor="let cat of categories"
      (click)="filterByCategory(cat.id)"
      [class]="selectedCategoryId === cat.id ? 'bg-primary text-white' : 'bg-[#f3ece7]'"
      class="rounded-full px-5 py-2 transition-colors whitespace-nowrap">
      {{ cat.nom }} ({{ getTemplatesByCategory(cat.id).length }})
    </button>
  </div>

  <div *ngIf="!isLoading && displayedTemplates.length > 0" 
       class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
    
    <div *ngFor="let template of displayedTemplates" class="border rounded-xl p-4 bg-white shadow-sm flex flex-col">
      <div class="text-primary font-bold text-xs mb-2 uppercase tracking-wider">
        {{ template.categorie_nom }}
      </div>
      
      <h3 class="font-bold text-lg mb-2">{{ template.nom }}</h3>
      
      <p class="text-sm text-gray-600 flex-grow">
        {{ template.description || 'Prêt à l\'emploi pour vos documents.' }}
      </p>
      
      <div class="flex gap-2 mt-6">
        <button [routerLink]="['/user/template-preview', template.id]" 
                class="flex-1 border border-gray-200 rounded-lg p-2 text-xs font-medium hover:bg-gray-50 transition-colors">
          Aperçu
        </button>
        <button [routerLink]="['/user/dynamic-form', template.id]" 
                class="flex-1 bg-primary text-white rounded-lg p-2 text-xs font-medium hover:opacity-90 transition-colors">
          Utiliser
        </button>
      </div>
    </div>
  </div>

  <div *ngIf="isLoading" class="text-center py-20">
    <div class="inline-block animate-spin rounded-full h-8 w-8 border-4 border-primary border-t-transparent mb-4"></div>
    <p class="italic text-gray-500">Chargement de la bibliothèque...</p>
  </div>

  <div *ngIf="!isLoading && displayedTemplates.length === 0" class="text-center py-20 border-2 border-dashed rounded-3xl">
    <p class="text-gray-500">Aucun template ne correspond à cette catégorie.</p>
    <button (click)="filterByCategory(null)" class="text-primary font-bold mt-2 underline">
      Voir tous les modèles
    </button>
  </div>
</div>