<!-- Main Content -->
<main class="flex-1 flex flex-col overflow-y-auto">
  <!-- Top Navigation -->
  <header class="sticky top-0 z-10 flex items-center justify-between border-b border-[#f3ece7] dark:border-[#3a2a1d] bg-background-light/80 dark:bg-background-dark/80 backdrop-blur-md px-8 py-4">
    <div class="flex items-center gap-8 flex-1 max-w-2xl">
      <label class="flex flex-col flex-1 h-10">
        <div class="flex w-full flex-1 items-stretch rounded-lg bg-[#f3ece7] dark:bg-[#3a2a1d]">
          <div class="text-[#9a6c4c] flex items-center justify-center pl-4">
            <span class="material-symbols-outlined">search</span>
          </div>
          <input class="w-full border-none bg-transparent focus:ring-0 text-[#1b130d] dark:text-[#fcfaf8] placeholder-[#9a6c4c] px-4 text-base" placeholder="Rechercher un document..." value=""/>
        </div>
      </label>
    </div>
    <div class="flex items-center gap-4 ml-4">
      <button class="p-2 rounded-lg bg-[#f3ece7] dark:bg-[#3a2a1d] text-[#1b130d] dark:text-[#fcfaf8] hover:bg-primary/20 transition-colors">
        <span class="material-symbols-outlined">notifications</span>
      </button>
      <div class="h-8 w-[1px] bg-[#f3ece7] dark:bg-[#3a2a1d]"></div>
      <button class="flex items-center gap-2 p-1 pr-3 rounded-full bg-[#f3ece7] dark:bg-[#3a2a1d] text-[#1b130d] dark:text-[#fcfaf8]">
        <div class="size-8 rounded-full bg-cover bg-center" data-alt="Photo de profil de l'utilisateur" style="background-image: url('https://lh3.googleusercontent.com/...');"></div>
        <span class="text-sm font-medium">M. Lefebvre</span>
      </button>
    </div>
  </header>

  <!-- Page Content -->
  <div class="p-8 max-w-6xl mx-auto w-full">
    <!-- Heading -->
    <div class="flex flex-col md:flex-row md:items-end justify-between gap-4 mb-8">
      <div>
        <h2 class="text-3xl font-extrabold text-[#1b130d] dark:text-[#fcfaf8] tracking-tight">Historique des Documents</h2>
        <p class="text-[#9a6c4c] dark:text-[#b08b72] mt-1">Gérez et téléchargez vos documents précédemment générés.</p>
      </div>
      <button routerLink="/user/document-generation" class="bg-primary hover:bg-primary/90 text-white px-5 py-2.5 rounded-lg font-bold flex items-center gap-2 transition-all shadow-lg shadow-primary/20">
        <span class="material-symbols-outlined">add</span>
        Nouveau Document
      </button>
    </div>

    <!-- Filters -->
    <div class="flex gap-2 mb-6 overflow-x-auto pb-2 scrollbar-hide">
      <button class="flex h-9 shrink-0 items-center justify-center gap-x-2 rounded-lg bg-primary text-white px-4 text-sm font-semibold">Tous</button>
      <button class="flex h-9 shrink-0 items-center justify-center gap-x-2 rounded-lg bg-[#f3ece7] dark:bg-[#3a2a1d] px-4 text-sm font-medium text-[#1b130d] dark:text-[#fcfaf8] hover:bg-[#e9ded5] dark:hover:bg-[#4a3a2d]">
        Factures <span class="material-symbols-outlined text-lg">expand_more</span>
      </button>
      <button class="flex h-9 shrink-0 items-center justify-center gap-x-2 rounded-lg bg-[#f3ece7] dark:bg-[#3a2a1d] px-4 text-sm font-medium text-[#1b130d] dark:text-[#fcfaf8] hover:bg-[#e9ded5] dark:hover:bg-[#4a3a2d]">
        Contrats <span class="material-symbols-outlined text-lg">expand_more</span>
      </button>
      <button class="flex h-9 shrink-0 items-center justify-center gap-x-2 rounded-lg bg-[#f3ece7] dark:bg-[#3a2a1d] px-4 text-sm font-medium text-[#1b130d] dark:text-[#fcfaf8] hover:bg-[#e9ded5] dark:hover:bg-[#4a3a2d]">
        Rapports <span class="material-symbols-outlined text-lg">expand_more</span>
      </button>
    </div>

    <div *ngIf="isLoading" class="bg-white dark:bg-[#2d2116] rounded-xl border border-[#f3ece7] dark:border-[#3a2a1d] p-10 text-center">
      <div class="inline-block animate-spin rounded-full h-8 w-8 border-4 border-primary border-t-transparent mb-4"></div>
      <p class="text-[#9a6c4c] dark:text-[#b08b72]">Chargement de l'historique...</p>
    </div>

    <div *ngIf="!isLoading && errorMessage" class="bg-red-50 border border-red-200 rounded-xl p-6 text-red-700">
      {{ errorMessage }}
    </div>

    <div *ngIf="!isLoading && !errorMessage" class="bg-white dark:bg-[#2d2116] rounded-xl border border-[#f3ece7] dark:border-[#3a2a1d] overflow-hidden shadow-sm">
      <table class="w-full text-left border-collapse" *ngIf="documents.length > 0; else emptyState">
        <thead>
          <tr class="bg-[#f3ece7] dark:bg-[#3a2a1d] border-b border-[#f3ece7] dark:border-[#3a2a1d]">
            <th class="px-6 py-4 text-xs font-bold uppercase tracking-wider">Nom du Document</th>
            <th class="px-6 py-4 text-xs font-bold uppercase tracking-wider">Date de création</th>
            <th class="px-6 py-4 text-xs font-bold uppercase tracking-wider">Format</th>
            <th class="px-6 py-4 text-xs font-bold uppercase tracking-wider">Statut</th>
            <th class="px-6 py-4 text-xs font-bold uppercase tracking-wider text-right">Actions</th>
          </tr>
        </thead>
        <tbody class="divide-y divide-[#f3ece7] dark:divide-[#3a2a1d]">
          <tr *ngFor="let doc of documents" class="hover:bg-[#f3ece7]/50 transition-colors">
            <td class="px-6 py-4">
              <div class="flex items-center gap-3">
                <div class="size-9 bg-primary/10 rounded flex items-center justify-center text-primary">
                  <span class="material-symbols-outlined">description</span>
                </div>
                <div>
                  <p class="text-sm font-bold">{{ doc.template_nom }}</p>
                  <p class="text-xs text-[#9a6c4c] dark:text-[#b08b72]">{{ doc.format | uppercase }}</p>
                </div>
              </div>
            </td>
            <td class="px-6 py-4">
              <p class="text-sm text-[#1b130d] dark:text-[#fcfaf8]">{{ doc.date_generation | date:'dd MMM yyyy' }}</p>
            </td>
            <td class="px-6 py-4">
              <span class="px-2 py-1 rounded-md text-[10px] font-bold uppercase tracking-wide bg-warm-beige text-[#1b130d] border border-[#e9ded5]">{{ doc.format }}</span>
            </td>
            <td class="px-6 py-4">
              <span class="px-2 py-1 rounded-md text-[10px] font-bold uppercase tracking-wide bg-primary/10 text-primary border border-primary/20">{{ doc.status }}</span>
            </td>
            <td class="px-6 py-4 text-right">
              <div class="flex justify-end gap-2">
                <button [routerLink]="['/user/document-preview', doc.id]" class="p-2 hover:bg-primary/10 rounded-lg transition-all">
                  <span class="material-symbols-outlined">visibility</span>
                </button>
                <button (click)="onDownload(doc)" class="p-2 hover:bg-primary/10 rounded-lg transition-all">
                  <span class="material-symbols-outlined">download</span>
                </button>
              </div>
            </td>
          </tr>
        </tbody>
      </table>

      <ng-template #emptyState>
        <div class="p-10 text-center text-[#9a6c4c] dark:text-[#b08b72]">
          Aucun document dans votre historique.
        </div>
      </ng-template>
    </div>
  </div>
</main>
