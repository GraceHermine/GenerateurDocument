<!-- Main Content -->
<main class="flex-1 flex flex-col overflow-y-auto">
  <!-- Top Navigation -->
  <header class="sticky top-0 z-10 flex items-center justify-between border-b border-[#f3ece7] dark:border-[#3a2a1d] bg-background-light/80 dark:bg-background-dark/80 backdrop-blur-md px-8 py-4">
    <div class="flex items-center gap-8 flex-1 max-w-2xl">
      <label class="flex flex-col flex-1 h-10">
        <div class="flex w-full flex-1 items-stretch rounded-lg bg-[#f3ece7] dark:bg-[#3a2a1d]">
          <div class="text-[#9a6c4c] flex items-center justify-center pl-4">
            <span class="material-symbols-outlined">search</span>
          </div>
          <input class="w-full border-none bg-transparent focus:ring-0 text-[#1b130d] dark:text-[#fcfaf8] placeholder-[#9a6c4c] px-4 text-base" placeholder="Rechercher un document..." value=""/>
        </div>
      </label>
    </div>
    <div class="flex items-center gap-4 ml-4">
      <button class="p-2 rounded-lg bg-[#f3ece7] dark:bg-[#3a2a1d] text-[#1b130d] dark:text-[#fcfaf8] hover:bg-primary/20 transition-colors">
        <span class="material-symbols-outlined">notifications</span>
      </button>
      <div class="h-8 w-[1px] bg-[#f3ece7] dark:bg-[#3a2a1d]"></div>
      <button class="flex items-center gap-2 p-1 pr-3 rounded-full bg-[#f3ece7] dark:bg-[#3a2a1d] text-[#1b130d] dark:text-[#fcfaf8]">
        <div class="size-8 rounded-full bg-cover bg-center" style="background-color: #ccc;"></div>
        <span class="text-sm font-medium">Utilisateur</span>
      </button>
    </div>
  </header>

  <!-- Page Content -->
  <div class="p-8 max-w-6xl mx-auto w-full">
    <!-- Heading -->
    <div class="flex flex-col md:flex-row md:items-end justify-between gap-4 mb-8">
      <div>
        <h2 class="text-3xl font-extrabold text-[#1b130d] dark:text-[#fcfaf8] tracking-tight">Historique des Documents</h2>
        <p class="text-[#9a6c4c] dark:text-[#b08b72] mt-1">Gérez et téléchargez vos documents précédemment générés.</p>
      </div>
      <button routerLink="/documents/new" class="bg-primary hover:bg-primary/90 text-white px-5 py-2.5 rounded-lg font-bold flex items-center gap-2 transition-all shadow-lg shadow-primary/20">
        <span class="material-symbols-outlined">add</span>
        Nouveau Document
      </button>
    </div>

    <!-- Loading State -->
    <div *ngIf="isLoading" class="flex justify-center py-8">
      <div class="animate-spin rounded-full h-12 w-12 border-b-2 border-primary"></div>
    </div>

    <div *ngIf="!isLoading">
      <!-- Filters -->
      <div class="flex gap-2 mb-6 overflow-x-auto pb-2 scrollbar-hide">
        <button (click)="filterByCategory('Tous')"
                [class.bg-primary]="currentCategory === 'Tous'"
                [class.text-white]="currentCategory === 'Tous'"
                [class.bg-[#f3ece7]]="currentCategory !== 'Tous'"
                class="flex h-9 shrink-0 items-center justify-center gap-x-2 rounded-lg px-4 text-sm font-semibold transition-colors">
          Tous
        </button>
        
        <button *ngFor="let cat of categories" 
                (click)="filterByCategory(cat)"
                [class.bg-primary]="currentCategory === cat"
                [class.text-white]="currentCategory === cat"
                [class.bg-[#f3ece7]]="currentCategory !== cat"
                class="flex h-9 shrink-0 items-center justify-center gap-x-2 rounded-lg px-4 text-sm font-medium transition-colors hover:bg-[#e9ded5] dark:hover:bg-[#4a3a2d]">
          {{ cat }}
        </button>
      </div>

      <!-- Documents Table -->
      <div class="bg-white dark:bg-[#2d2116] rounded-xl border border-[#f3ece7] dark:border-[#3a2a1d] overflow-hidden shadow-sm">
        <table class="w-full text-left border-collapse">
          <thead>
            <tr class="bg-[#f3ece7] dark:bg-[#3a2a1d] border-b border-[#f3ece7] dark:border-[#3a2a1d]">
              <th class="px-6 py-4 text-xs font-bold uppercase tracking-wider">Nom du Document</th>
              <th class="px-6 py-4 text-xs font-bold uppercase tracking-wider">Date de création</th>
              <th class="px-6 py-4 text-xs font-bold uppercase tracking-wider">Catégorie</th>
              <th class="px-6 py-4 text-xs font-bold uppercase tracking-wider">Statut</th>
              <th class="px-6 py-4 text-xs font-bold uppercase tracking-wider text-right">Actions</th>
            </tr>
          </thead>
          <tbody class="divide-y divide-[#f3ece7] dark:divide-[#3a2a1d]">
            <tr *ngFor="let doc of filteredDocuments" class="hover:bg-[#f3ece7]/50 transition-colors">
              <td class="px-6 py-4">
                <div class="flex items-center gap-3">
                  <div class="size-9 bg-primary/10 rounded flex items-center justify-center text-primary group-hover:bg-primary group-hover:text-white transition-colors">
                    <span class="material-symbols-outlined">
                        {{ doc.format === 'pdf' ? 'picture_as_pdf' : 'description' }}
                    </span>
                  </div>
                  <div>
                    <p class="text-sm font-bold">{{ doc.template_nom }}</p>
                    <p class="text-xs text-[#9a6c4c] dark:text-[#b08b72] uppercase">{{ doc.format }}</p>
                  </div>
                </div>
              </td>
              <td class="px-6 py-4">
                <p class="text-sm text-[#1b130d] dark:text-[#fcfaf8]">{{ doc.date_generation | date:'medium' }}</p>
              </td>
              <td class="px-6 py-4">
                <span class="px-2 py-1 rounded-md text-[10px] font-bold uppercase tracking-wide bg-accent-yellow/10 text-accent-yellow border border-accent-yellow/20">
                    {{ doc.categorie_nom || 'Non classé' }}
                </span>
              </td>
              <td class="px-6 py-4">
                <span [class]="getStatusClass(doc.status)" class="px-2 py-1 rounded-md text-[10px] font-bold uppercase tracking-wide border">
                    {{ getStatusLabel(doc.status) }}
                </span>
              </td>
              <td class="px-6 py-4 text-right">
                <div class="flex justify-end gap-2">
                  <button class="p-2 hover:bg-primary/10 rounded-lg transition-all" title="Voir les détails">
                    <span class="material-symbols-outlined">visibility</span>
                  </button>
                  <button (click)="downloadDocument(doc)" 
                          [disabled]="doc.status !== 'done'"
                          [class.opacity-50]="doc.status !== 'done'"
                          class="p-2 hover:bg-primary/10 rounded-lg transition-all" 
                          title="Télécharger">
                    <span class="material-symbols-outlined">download</span>
                  </button>
                </div>
              </td>
            </tr>
            
            <tr *ngIf="filteredDocuments.length === 0">
                <td colspan="5" class="px-6 py-8 text-center text-[#9a6c4c]">
                    Aucun document trouvé.
                </td>
            </tr>
          </tbody>
        </table>
      </div>
    </div>
  </div>
</main>
